<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="//sdk.amazonaws.com/js/aws-sdk-2.701.0.min.js"></script>

<script>
  const awsRegionInput = $('#aws-region');
  const awsAccessKeyIdInput = $('#aws-access-key-id');
  const awsSecretAccessKeyInput = $('#aws-secret-access-key');

  function loadPreferences(options) {
    awsRegionInput.val(options.awsRegion);
    awsAccessKeyIdInput.val(options.awsAccessKeyId);
    awsSecretAccessKeyInput.val(options.awsSecretAccessKey);

    toggleLoader();
  }

  function save(e) {
    e.preventDefault()

    const awsRegion = awsRegionInput.val().trim();
    const awsAccessKeyId = awsAccessKeyIdInput.val().trim();
    const awsSecretAccessKey = awsSecretAccessKeyInput.val().trim();

    google.script.run.
        withFailureHandler(showError).
        withSuccessHandler(function() {
          showSuccess('The AWS credentials has been updated.');
        }).
        setPreferences({
          awsRegion,
	      awsAccessKeyId,
	      awsSecretAccessKey,
        });

    clearResult();
  }

  function reset(e) {
    e.preventDefault()

    google.script.run.
        withFailureHandler(showError).
        withSuccessHandler(function() {
          showSuccess('The AWS credentials have been reset.');
        }).
        setPreferences({
          awsRegion: '',
	      awsAccessKeyId: '',
	      awsSecretAccessKey: '',
        });

    awsRegionInput.val('');
    awsAccessKeyIdInput.val('');
    awsSecretAccessKeyInput.val('');

    clearResult();
  }

  function showError(message) {
    $('#result').html(`<p class="error">Error. ${message}</p>`);
  }

  function showSuccess(message) {
    $('#result').html(`<p class="success">Success. ${message}</p>`);
  }

  function clearResult() {
    $('#result').html('');
  }

  function toggleLoader() {
    $('#loader').toggle();
    $('#form').toggle();
  }

  $('#save').click(save);
  $('#reset').click(reset);

  google.script.run.withSuccessHandler(loadPreferences).getPreferences();
</script>
